{"ast":null,"code":"import{createContext,useContext,useState,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const handleCredentialResponse=response=>{try{const userInfo=parseJwt(response.credential);const userData={id:userInfo.sub,email:userInfo.email,name:userInfo.name,picture:userInfo.picture,given_name:userInfo.given_name,family_name:userInfo.family_name,isSetup:true,loginTime:new Date().toISOString()};setUser(userData);setIsAuthenticated(true);setError(null);localStorage.setItem('bookApp_user',JSON.stringify(userData));localStorage.setItem('bookApp_isAuthenticated','true');}catch(error){console.error('Error processing Google sign-in:',error);setError('Failed to process Google sign-in');}};const parseJwt=token=>{try{const base64Url=token.split('.')[1];const base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');const jsonPayload=decodeURIComponent(window.atob(base64).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));return JSON.parse(jsonPayload);}catch(error){throw new Error('Invalid JWT token');}};const signOut=()=>{console.log('SignOut function called');// Clear all authentication data\nlocalStorage.clear();sessionStorage.clear();// Reset state\nsetUser(null);setIsAuthenticated(false);setError(null);// Disable Google auto-select\nif(window.google){try{window.google.accounts.id.disableAutoSelect();}catch(error){console.log('Google disableAutoSelect error:',error);}}// Force page reload to ensure clean state\nsetTimeout(()=>{window.location.replace('/');},100);};useEffect(()=>{const initializeGoogleAuth=()=>{if(window.google&&process.env.REACT_APP_GOOGLE_CLIENT_ID){try{window.google.accounts.id.initialize({client_id:process.env.REACT_APP_GOOGLE_CLIENT_ID,callback:handleCredentialResponse,auto_select:false,cancel_on_tap_outside:false});// Check authentication state\nconst savedUser=localStorage.getItem('bookApp_user');const savedAuth=localStorage.getItem('bookApp_isAuthenticated');if(savedUser&&savedAuth==='true'){try{const userData=JSON.parse(savedUser);setUser(userData);setIsAuthenticated(true);}catch(error){localStorage.clear();setUser(null);setIsAuthenticated(false);}}else{setUser(null);setIsAuthenticated(false);}}catch(error){setError('Failed to initialize Google authentication');setUser(null);setIsAuthenticated(false);}}else{setUser(null);setIsAuthenticated(false);}setLoading(false);};if(!window.google){const script=document.createElement('script');script.src='https://accounts.google.com/gsi/client';script.async=true;script.defer=true;script.onload=()=>setTimeout(initializeGoogleAuth,100);script.onerror=()=>{setError('Failed to load Google authentication');setLoading(false);};document.head.appendChild(script);}else{initializeGoogleAuth();}},[]);const value={user,isAuthenticated,loading,error,signOut,setError};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["createContext","useContext","useState","useEffect","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","isAuthenticated","setIsAuthenticated","loading","setLoading","error","setError","handleCredentialResponse","response","userInfo","parseJwt","credential","userData","id","sub","email","name","picture","given_name","family_name","isSetup","loginTime","Date","toISOString","localStorage","setItem","JSON","stringify","console","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","window","atob","map","c","charCodeAt","toString","slice","join","parse","signOut","log","clear","sessionStorage","google","accounts","disableAutoSelect","setTimeout","location","initializeGoogleAuth","process","env","REACT_APP_GOOGLE_CLIENT_ID","initialize","client_id","callback","auto_select","cancel_on_tap_outside","savedUser","getItem","savedAuth","script","document","createElement","src","async","defer","onload","onerror","head","appendChild","value","Provider"],"sources":["C:/Users/T K/Desktop/personalized-book-recommendations/src/contexts/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const handleCredentialResponse = (response) => {\r\n    try {\r\n      const userInfo = parseJwt(response.credential);\r\n      const userData = {\r\n        id: userInfo.sub,\r\n        email: userInfo.email,\r\n        name: userInfo.name,\r\n        picture: userInfo.picture,\r\n        given_name: userInfo.given_name,\r\n        family_name: userInfo.family_name,\r\n        isSetup: true,\r\n        loginTime: new Date().toISOString()\r\n      };\r\n\r\n      setUser(userData);\r\n      setIsAuthenticated(true);\r\n      setError(null);\r\n      \r\n      localStorage.setItem('bookApp_user', JSON.stringify(userData));\r\n      localStorage.setItem('bookApp_isAuthenticated', 'true');\r\n\r\n    } catch (error) {\r\n      console.error('Error processing Google sign-in:', error);\r\n      setError('Failed to process Google sign-in');\r\n    }\r\n  };\r\n\r\n  const parseJwt = (token) => {\r\n    try {\r\n      const base64Url = token.split('.')[1];\r\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n      const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {\r\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r\n      }).join(''));\r\n      return JSON.parse(jsonPayload);\r\n    } catch (error) {\r\n      throw new Error('Invalid JWT token');\r\n    }\r\n  };\r\n\r\n  const signOut = () => {\r\n    console.log('SignOut function called');\r\n    \r\n    // Clear all authentication data\r\n    localStorage.clear();\r\n    sessionStorage.clear();\r\n    \r\n    // Reset state\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n    setError(null);\r\n    \r\n    // Disable Google auto-select\r\n    if (window.google) {\r\n      try {\r\n        window.google.accounts.id.disableAutoSelect();\r\n      } catch (error) {\r\n        console.log('Google disableAutoSelect error:', error);\r\n      }\r\n    }\r\n    \r\n    // Force page reload to ensure clean state\r\n    setTimeout(() => {\r\n      window.location.replace('/');\r\n    }, 100);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const initializeGoogleAuth = () => {\r\n      if (window.google && process.env.REACT_APP_GOOGLE_CLIENT_ID) {\r\n        try {\r\n          window.google.accounts.id.initialize({\r\n            client_id: process.env.REACT_APP_GOOGLE_CLIENT_ID,\r\n            callback: handleCredentialResponse,\r\n            auto_select: false,\r\n            cancel_on_tap_outside: false,\r\n          });\r\n          \r\n          // Check authentication state\r\n          const savedUser = localStorage.getItem('bookApp_user');\r\n          const savedAuth = localStorage.getItem('bookApp_isAuthenticated');\r\n          \r\n          if (savedUser && savedAuth === 'true') {\r\n            try {\r\n              const userData = JSON.parse(savedUser);\r\n              setUser(userData);\r\n              setIsAuthenticated(true);\r\n            } catch (error) {\r\n              localStorage.clear();\r\n              setUser(null);\r\n              setIsAuthenticated(false);\r\n            }\r\n          } else {\r\n            setUser(null);\r\n            setIsAuthenticated(false);\r\n          }\r\n        } catch (error) {\r\n          setError('Failed to initialize Google authentication');\r\n          setUser(null);\r\n          setIsAuthenticated(false);\r\n        }\r\n      } else {\r\n        setUser(null);\r\n        setIsAuthenticated(false);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    if (!window.google) {\r\n      const script = document.createElement('script');\r\n      script.src = 'https://accounts.google.com/gsi/client';\r\n      script.async = true;\r\n      script.defer = true;\r\n      script.onload = () => setTimeout(initializeGoogleAuth, 100);\r\n      script.onerror = () => {\r\n        setError('Failed to load Google authentication');\r\n        setLoading(false);\r\n      };\r\n      document.head.appendChild(script);\r\n    } else {\r\n      initializeGoogleAuth();\r\n    }\r\n  }, []);\r\n\r\n  const value = {\r\n    user,\r\n    isAuthenticated,\r\n    loading,\r\n    error,\r\n    signOut,\r\n    setError\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}